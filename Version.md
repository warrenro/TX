# 版本與開發歷程

本文件記錄了 `tx_downloader` 專案從概念到實現的開發歷程，包含關鍵的開發提示詞以及版本迭代的更新紀錄。

---

## 1. 開發提示詞歷程 (Prompt History)

以下是建構此專案時，與 AI 協作的關鍵提示詞摘要：

1.  **基礎功能建立**:
    > "請建立一個 Python 腳本，使用 `shioaji` 套件下載台指期近月合約的 1 分鐘 K 線資料，並將其儲存為 CSV 檔案。"

2.  **連續月資料功能**:
    > "擴充腳本，加入下載連續月資料的功能。請實作換月邏輯：一個合約的交易期間，是從上個合約到期日的隔天，到自己到期日當天。"

3.  **整合 Firestore**:
    > "為腳本增加將資料寫入 Google Cloud Firestore 的功能。資料需分批次寫入，並使用 K 線時間作為文件 ID。"

4.  **使用者互動介面**:
    > "加入一個啟動選單，讓使用者可以選擇儲存方式：1. 僅儲存至 Firebase，2. 僅儲存為 CSV，3. 同時儲存。"

5.  **安全性與組態優化**:
    > "將所有敏感資訊（如 API Key、密碼、檔案路徑）從程式碼中分離出來，改用 `.env` 檔案進行管理。請整合 `python-dotenv` 套件並提供 `.env.example` 範本。"

6.  **程式碼重構與物件導向**:
    > "將腳本重構為一個名為 `TXFDownloader` 的 Class，將登入、下載、處理、儲存等功能分別封裝成獨立的方法，以提高程式碼的可讀性與可維護性。"

7.  **錯誤處理與使用者體驗**:
    > "為腳本加入完整的錯誤處理機制，包含 API 登入失敗、憑證錯誤、找不到金鑰檔案、無歷史資料等情況，並提供清晰的提示訊息。同時，修正使用者輸入全形數字時無法辨識的問題。"

8.  **專案文件化**:
    > "為此專案建立完整的說明文件，包含 `README.md`（使用者指南）和 `spec.md`（軟體需求規格書）。"

---

## 2. 版本更新歷程 (Changelog)

### **v1.7 (2025-11-19)**
-   **功能**: 在程式啟動並成功登入後，自動呼叫 `api.usage()` 查詢並顯示目前的 API 流量使用狀況，幫助使用者監控用量。

### **v1.6 (2025-11-19)**
-   **功能**: 將命令列參數改為互動式選單，讓使用者能更直覺地選擇下載區間。
-   **重構**: 將腳本中的 `print` 語句全面替換為結構化的 `logging` 日誌系統，提升輸出資訊的可讀性與專業性。
-   **優化**: 加入了更明確的錯誤處理回饋，當無資料可下載時會提示使用者。
-   **文件**: 全面檢視並更新所有專案文件 (`README.md`, `spec.md`, `Version.md`)，使其與最終程式碼保持一致。

### **v1.5 (2025-11-19)**
-   **重構**: 為了最大化版本相容性，將 K 線獲取邏輯重構為「先使用 `api.ticks` 下載逐筆成交資料，再手動使用 `pandas` 重新取樣 (resample) 為 1 分鐘 K 線」。
-   **優化**: 在下載函式中加入日期迴圈，以處理 `api.ticks` 一次只能下載一天的限制。
-   **文件**: 全面更新 `spec.md` 與 `Version.md` 以反映最新的程式架構。

### **v1.4 (2025-11-19) - (偵錯階段)**
-   **修正**: 根據 `shioaji` API 的版本差異，對 `kbars` 方法的參數 (`freq`, `timeframe`, `kbar`) 進行了多次嘗試與修正。
-   **修正**: 修正了 `shioaji.TickSToKbars` 的大小寫拼寫錯誤。
-   **修正**: 修正了因 `try/except` 結構錯誤導致的 `SyntaxError`。
-   **修正**: 修正了因縮排錯誤導致的 `IndentationError`。

### **v1.3 (2025-11-19)**
-   **功能**: 在程式啟動時加入 `shioaji` 版本檢查機制，確保使用者執行的版本與腳本相容，避免因 API 版本差異導致的執行錯誤。
-   **修正**: 根據版本相容性，將 `kbars` 方法的 K 棒週期參數確定為 `kbar`。
-   **依賴**: 在 `requirements.txt` 中新增 `packaging` 套件。

### **v1.2 (2025-11-19)**
-   **修正**: 修正了使用者在選單輸入全形數字時導致無法辨識的問題。
-   **修正**: 啟用了 `python-dotenv` 的載入功能，確保 `.env` 檔案能被正確讀取。
-   **優化**: 移除了程式碼中用於偵錯的 `print` 語句，避免金鑰資訊外洩。

### **v1.1 (2025-11-18)**
-   **功能**: 加入了互動式選單，讓使用者可選擇儲存至 Firebase、CSV 或兩者皆是。
-   **功能**: 整合 `python-dotenv`，將所有敏感資訊移至 `.env` 檔案管理，並提供 `.env.example` 範本。
-   **文件**: 建立了 `README.md` 和 `spec.md`，提供完整的使用說明與技術規格。

### **v1.0 (2025-11-17)**
-   **功能**: 專案初始化，實現核心下載功能。
-   **功能**: 支援下載近月合約與連續月合約的 1 分鐘 K 線資料。
-   **功能**: 支援將資料儲存為 CSV 檔案及寫入 Google Cloud Firestore。
-   **功能**: 將程式碼重構為 `TXFDownloader` Class，提升結構化程度。