# 版本與開發歷程

本文件記錄了 `tx_downloader` 專案從概念到實現的開發歷程，包含關鍵的開發提示詞以及版本迭代的更新紀錄。

---

## 2. 版本更新歷程 (Changelog)

### **v2.2 (2025-11-21)**
-   **功能 (可靠性)**: 新增 Token 自動更新機制。當 API Token 在長時間下載過程中過期時，系統會自動嘗試重新登入並重試一次，提升下載穩定性。
-   **功能 (續傳)**: 實作下載中斷續傳功能。若 Ticks 資料下載中斷，程式下次啟動時會自動從上次失敗的日期繼續，無需從頭開始。
-   **功能 (彈性)**: 將 Ticks 與 K-bar 的下載功能分離，並提供獨立選單讓使用者可以選擇：a) 僅下載 Ticks，b) 僅下載 K-bar，或 c) 兩者都下載。
-   **文件**: 更新 `spec.md`, `README.md`, `Version.md` 以反映新功能。

### **v1.7 (2025-11-19)**
-   **功能**: 在程式啟動並成功登入後，自動呼叫 `api.usage()` 查詢並顯示目前的 API 流量使用狀況，幫助使用者監控用量。

### **v1.6 (2025-11-19)**
-   **功能**: 將命令列參數改為互動式選單，讓使用者能更直覺地選擇下載區間。
-   **重構**: 將腳本中的 `print` 語句全面替換為結構化的 `logging` 日誌系統，提升輸出資訊的可讀性與專業性。
-   **優化**: 加入了更明確的錯誤處理回饋，當無資料可下載時會提示使用者。
-   **文件**: 全面檢視並更新所有專案文件 (`README.md`, `spec.md`, `Version.md`)，使其與最終程式碼保持一致。

### **v1.5 (2025-11-19)**
-   **重構**: 為了最大化版本相容性，將 K 線獲取邏輯重構為「先使用 `api.ticks` 下載逐筆成交資料，再手動使用 `pandas` 重新取樣 (resample) 為 1 分鐘 K 線」。
-   **優化**: 在下載函式中加入日期迴圈，以處理 `api.ticks` 一次只能下載一天的限制。
-   **文件**: 全面更新 `spec.md` 與 `Version.md` 以反映最新的程式架構。

### **v1.4 (2025-11-19) - (偵錯階段)**
-   **修正**: 根據 `shioaji` API 的版本差異，對 `kbars` 方法的參數 (`freq`, `timeframe`, `kbar`) 進行了多次嘗試與修正。
-   **修正**: 修正了 `shioaji.TickSToKbars` 的大小寫拼寫錯誤。
-   **修正**: 修正了因 `try/except` 結構錯誤導致的 `SyntaxError`。
-   **修正**: 修正了因縮排錯誤導致的 `IndentationError`。

### **v1.3 (2025-11-19)**
-   **功能**: 在程式啟動時加入 `shioaji` 版本檢查機制，確保使用者執行的版本與腳本相容，避免因 API 版本差異導致的執行錯誤。
-   **修正**: 根據版本相容性，將 `kbars` 方法的 K 棒週期參數確定為 `kbar`。
-   **依賴**: 在 `requirements.txt` 中新增 `packaging` 套件。

### **v1.2 (2025-11-19)**
-   **修正**: 修正了使用者在選單輸入全形數字時導致無法辨識的問題。
-   **修正**: 啟用了 `python-dotenv` 的載入功能，確保 `.env` 檔案能被正確讀取。
-   **優化**: 移除了程式碼中用於偵錯的 `print` 語句，避免金鑰資訊外洩。

### **v1.1 (2025-11-18)**
-   **功能**: 加入了互動式選單，讓使用者可選擇儲存至 Firebase、CSV 或兩者皆是。
-   **功能**: 合 `python-dotenv`，將所有敏感資訊移至 `.env` 檔案管理，並提供 `.env.example` 範本。
-   **文件**: 建立了 `README.md` 和 `spec.md`，提供完整的使用說明與技術規格。

### **v1.0 (2025-11-17)**
-   **功能**: 專案初始化，實現核心下載功能。
-   **功能**: 支援下載近月合約與連續月合約的 1 分鐘 K 線資料。
-   **功能**: 支援將資料儲存為 CSV 檔案及寫入 Google Cloud Firestore。
-   **功能**: 將程式碼重構為 `TXFDownloader` Class，提升結構化程度。